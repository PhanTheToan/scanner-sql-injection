import datetime


class Vulnerability:
    SEVERITY_LEVELS = ['low', 'medium', 'high', 'critical']
    
    def __init__(self, name, description, severity, payload, input_field, url):
        self.name = name
        self.description = description
        self.severity = severity.lower()
        self.payload = payload
        self.input_field = input_field
        self.url = url
        self.timestamp = datetime.datetime.now()
        
    def validate_severity(self):
        if self.severity not in self.SEVERITY_LEVELS:
            raise ValueError(f"Invalid severity level. Must be one of {self.SEVERITY_LEVELS}")

    def to_dict(self):
        return {
            'name': self.name,
            'description': self.description,
            'severity': self.severity,
            'payload': self.payload,
            'input_field': self.input_field,
            'url': self.url,
            'timestamp': self.timestamp.isoformat()
        }

    def __repr__(self):
        return f"<Vulnerability({self.severity}): {self.name} @ {self.url}>"
